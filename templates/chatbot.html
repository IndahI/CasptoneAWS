{% extends "layout.html" %} {% block title %}Melanoma Scan{%
  endblock %} {% block content %}
  
  <!-- Chatbot -->
  <div class="chatbot-container">
    <div class="chatbox">
      <div class="chatbox-header">Chatbot</div>
      <div class="chatbox-body" id="chatbox-body">
        <div class="message bot">
          <span> Silahkan tanya sesuatu </span>
        </div>
      </div>
      <div class="chatbox-footer">
        <input type="text" id="user-input" placeholder="Type a message..." />
        <button id="send-button"><i class="fas fa-arrow-up"></i></button>
      </div>
    </div>
  </div>
  <script>
    const userInput = document.getElementById("user-input");
    const sendButton = document.getElementById("send-button");
    const chatboxBody = document.getElementById("chatbox-body");
  
    function sendMessage() {
      const userMessage = userInput.value.trim();
      if (userMessage) {
        // Add user message
        const userMessageElement = document.createElement("div");
        userMessageElement.classList.add("message", "user");
        userMessageElement.textContent = userMessage;
        chatboxBody.appendChild(userMessageElement);
        userInput.value = "";
        
        // Scroll to bottom
        chatboxBody.scrollTop = chatboxBody.scrollHeight;
  
        // Add typing indicator
        const botMessageElement = document.createElement("div");
        botMessageElement.classList.add("message", "bot");
        botMessageElement.textContent = "Bot is typing...";
        chatboxBody.appendChild(botMessageElement);
        chatboxBody.scrollTop = chatboxBody.scrollHeight;
  
        // Send request to server
        fetch('/chatbot', {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: `message=${encodeURIComponent(userMessage)}`,
        })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            botMessageElement.textContent = data.message;
          } else {
            botMessageElement.textContent = data.message || 'Terjadi kesalahan. Silakan coba lagi.';
            botMessageElement.classList.add('error');
          }
  
          // Add action icons
          const iconContainer = document.createElement("div");
          iconContainer.classList.add("bot-icons");
  
          const copyIcon = document.createElement("i");
          copyIcon.classList.add("fas", "fa-copy", "icon", "copy-icon", "mr-2");
          copyIcon.addEventListener("click", () => {
            navigator.clipboard.writeText(botMessageElement.textContent)
              .then(() => alert("Text copied to clipboard!"))
              .catch(() => alert("Failed to copy text"));
          });
  
          const likeIcon = document.createElement("i");
          likeIcon.classList.add("fas", "fa-thumbs-up", "icon", "like-icon", "mr-2");
          likeIcon.addEventListener("click", () => {
            alert("You liked the message!");
          });
  
          const dislikeIcon = document.createElement("i");
          dislikeIcon.classList.add("fas", "fa-thumbs-down", "icon", "dislike-icon", "mr-2");
          dislikeIcon.addEventListener("click", () => {
            alert("You disliked the message!");
          });
  
          iconContainer.appendChild(copyIcon);
          iconContainer.appendChild(likeIcon);
          iconContainer.appendChild(dislikeIcon);
          botMessageElement.appendChild(iconContainer);
        })
        .catch(error => {
          botMessageElement.textContent = "Maaf, terjadi kesalahan. Silakan coba lagi nanti.";
          botMessageElement.classList.add('error');
        })
        .finally(() => {
          chatboxBody.scrollTop = chatboxBody.scrollHeight;
        });
      }
    }
  
    // Send on button click
    sendButton.addEventListener("click", sendMessage);
  
    // Send on Enter key
    userInput.addEventListener("keypress", (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        sendMessage();
      }
    });
  </script>
  
  <style>
    .message.error {
      color: #721c24;
      background-color: #f8d7da;
      border-color: #f5c6cb;
    }
  </style>
{% endblock %}